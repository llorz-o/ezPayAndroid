"use strict";(self["webpackChunkez_pay"]=self["webpackChunkez_pay"]||[]).push([[662],{5662:function(t,e,s){s.r(e),s.d(e,{default:function(){return _}});var a=function(){var t,e=this,s=e.$createElement,a=e._self._c||s;return a("div",{staticClass:"page page-transaction_sale"},[a("div",{staticClass:"top-wrapper"},[a("div",{staticClass:"card"},[a("div",{staticClass:"title"},[a("span",{staticClass:"split",class:{show:e.status==e.TRANSACTING_ORDER_STATUS.HANGING&&void 0!==e.orderInfo.isSplit}},[e.status==e.TRANSACTING_ORDER_STATUS.HANGING&&void 0!==e.orderInfo.isSplit?[e._v(" "+e._s(e.orderInfo.isSplit?"可拆分":"不可拆分")+" ")]:e._e()],2),a("span",{staticClass:"status",class:e._f("transactingOrderStatus")(e.status)},[e._v(" "+e._s(e._f("transactingOrderStatus")(e.status,"seller-content"))+" ")]),a("span",{staticClass:"btn",class:{loading:e.loading},on:{click:function(){return e.loadDetails(e.orderInfo.orderId)}}},[a("van-icon",{attrs:{name:"replay"}})],1)]),a("div",{staticClass:"time"},[e.status==e.TRANSACTING_ORDER_STATUS.HANGING?[e._v(" 创建时间 "+e._s(e._f("dateFormat")(e.orderInfo.createTime,"Y/M/D h:m:s"))+" ")]:e._e(),e.status==e.TRANSACTING_ORDER_STATUS.BUYER_REQUEST?[e._v(" 5分钟内未操作系统将默认卖家取消交易 ")]:e._e(),e.status==e.TRANSACTING_ORDER_STATUS.WAITING_FOR_TRANSFER?[e._v(" 买家15分钟内未操作,系统将默认买家取消交易 ")]:e._e(),e.status==e.TRANSACTING_ORDER_STATUS.TRANSFERRED?[e._v(" 20分钟内未操作，默认交易成功，将转币给买家 ")]:e._e(),e.status==e.TRANSACTING_ORDER_STATUS.DISPUTING?[e._v(" 争议订单将由官方客服介入协助处理 ")]:[e._v("   ")]],2),a("div",{staticClass:"orderId"},[e._v(" 挂单编号 "+e._s(e.orderInfo.orderNo)+" "),a("button",{directives:[{name:"clipboard",rawName:"v-clipboard",value:e.orderInfo.orderNo||"",expression:"orderInfo.orderNo || ''"}],staticClass:"copy copyBtn",on:{success:e.$root.copySuccessful}})])])]),a("van-cell",{staticClass:"kv amount",attrs:{title:"购买数量"}},[e._v(" Ezb "+e._s(parseFloat(e.orderInfo.amount).toFixed(2))+" ")]),a("van-cell",{staticClass:"kv payment",attrs:{title:"收款方式"}},[e.PAYMENT_METHOD.BANK===e.orderInfo.paymentType?a("div",{staticClass:"payment-icon bank"}):e._e(),e.PAYMENT_METHOD.ALI===e.orderInfo.paymentType?a("div",{staticClass:"payment-icon ali"}):e._e(),e.PAYMENT_METHOD.WE_CHAT===e.orderInfo.paymentType?a("div",{staticClass:"payment-icon wechat"}):e._e()]),e.STEP[e.status]>0?a("van-cell-group",{attrs:{title:"交易进度",border:!1},scopedSlots:e._u([{key:"title",fn:function(){return[a("span",{staticClass:"title"},[e._v("交易进度")]),e.status==e.TRANSACTING_ORDER_STATUS.BUYER_REQUEST||e.status==e.TRANSACTING_ORDER_STATUS.WAITING_FOR_TRANSFER||e.status==e.TRANSACTING_ORDER_STATUS.TRANSFERRED?a("span",{staticClass:"countdown"},[e._v(" 订单倒计时 "),a("van-count-down",{attrs:{time:e.countdown},on:{finish:e.onCountdownFinish}})],1):e._e()]},proxy:!0}],null,!1,3155898464)},[a("van-steps",{attrs:{active:e.stepsActive}},[a("van-step",[e._v(" "+e._s(e._f("dateFormat")(e.orderInfo.createTime,"M-D"))+" "),e.STEP[e.status]>=1?a("div",{staticClass:"bottom-status time"},[e._v(" "+e._s(e._f("dateFormat")(e.orderInfo.createTime,"h:m:s"))+" ")]):e._e()]),a("van-step",[e._v(" 卖家确认交易 "),e.STEP[e.status]>=1?a("div",{staticClass:"bottom-status",class:e._f("transactingOrderStatus")(e.status,void 0,1)},[e._v(" "+e._s(e._f("transactingOrderStatus")(e.status,"step",1))+" ")]):e._e()]),a("van-step",[e._v(" 买家转账 "),e.STEP[e.status]>=2?a("div",{staticClass:"bottom-status",class:(t={},t["time-over"]=e.isTimeoutDisputing,t[e.transactingOrderStatus(e.status,void 0,2)]=!0,t)},[e.isTimeoutDisputing?[e._v(" 超时取消 ")]:[e._v(" "+e._s(e._f("transactingOrderStatus")(e.status,"step",2))+" ")]],2):e._e()]),a("van-step",[e._v(" 交易完成 "),e.STEP[e.status]>=3?a("div",{staticClass:"bottom-status",class:e._f("transactingOrderStatus")(e.status)},[e._v(" "+e._s(e._f("transactingOrderStatus")(e.status,"step"))+" ")]):e._e()])],1)],1):e._e(),e.isSystemBuyer&&e.STEP[e.status]>=2?[a("div",{staticClass:"merchant"},[a("div",{staticClass:"title"},[e._v("买方付款信息")]),a("div",{staticClass:"description"},[e._v(" 该用户为平台认证用户，付款信息暂不展示，请卖家查询到款后 放心确认转币 ")]),a("div",{staticClass:"certificated"}),a("div",{staticClass:"certification"}),a(e.componentsMapping[e.radio],{tag:"components",staticClass:"paymentInfo",attrs:{title:"卖方收款信息",hide:e.hide,payment:e.hide?void 0:e.sellerPayment}}),e._m(0)],1)]:[a(e.componentsMapping[e.radio],{tag:"components",attrs:{title:"买方付款信息",hide:e.hide,payment:e.hide?void 0:e.buyerPayment}}),a(e.componentsMapping[e.radio],{tag:"components",attrs:{title:"卖方收款信息",hide:e.hide,payment:e.hide?void 0:e.sellerPayment}}),e.status==e.TRANSACTING_ORDER_STATUS.TRANSFERRED||e.status==e.TRANSACTING_ORDER_STATUS.SELLER_DID_NOT_RECEIVE&&!e.isCountdownEnd||e.status==e.TRANSACTING_ORDER_STATUS.DISPUTING?[a("van-image",{staticClass:"certificationImage",attrs:{src:e.orderInfo.voucher,fit:"contain"}})]:e._e(),e.status==e.TRANSACTING_ORDER_STATUS.WAITING_FOR_TRANSFER||e.status==e.TRANSACTING_ORDER_STATUS.TRANSFERRED?[a("div",{staticClass:"warning"},[e._v(" 1.请认真核对买方付款信息，如「到款信息与买方付款信息不一 致」或「未收到付款」千万不要放行您的数字货币，一旦确认我 已收到款 ")]),a("div",{staticClass:"warning"},[e._v("2.收到买方真实付款后点击「确认转币」")])]:e._e()],a("div",{staticClass:"btns"},[e.status==e.TRANSACTING_ORDER_STATUS.BUYER_REQUEST?[a("van-button",{staticClass:"danger block",on:{click:e.cancel_transaction}},[e._v(" 取消交易 ")]),a("van-button",{staticClass:"primary block",on:{click:e.start_transaction}},[e._v(" 开始交易 ")])]:e._e(),e.status==e.TRANSACTING_ORDER_STATUS.WAITING_FOR_TRANSFER||e.status==e.TRANSACTING_ORDER_STATUS.TRANSFERRED?[a("van-button",{staticClass:"danger block",class:{disabled:e.status!=e.TRANSACTING_ORDER_STATUS.TRANSFERRED},on:{click:e.did_not_received}},[e._v(" 未收到转账 ")]),a("van-button",{staticClass:"primary block",class:{disabled:e.status!=e.TRANSACTING_ORDER_STATUS.TRANSFERRED},on:{click:e.confirm_transfer}},[e._v(" 确认转币 ")])]:e._e(),e.status==e.TRANSACTING_ORDER_STATUS.DISPUTING?[a("van-button",{staticClass:"primary block"},[e._v(" 联系客服 ")])]:e._e()],2),a("van-dialog",{staticClass:"applyDialog",attrs:{title:"请简要描述您的申诉内容","show-cancel-button":"","confirm-button-text":"提交申诉","confirm-button-color":"#6F59FE"},model:{value:e.show_apply,callback:function(t){e.show_apply=t},expression:"show_apply"}},[a("van-field",{attrs:{autocomplete:e.$root.getHash(),rows:"3",autosize:"",type:"textarea",maxlength:"50",placeholder:"0/50","show-word-limit":""},model:{value:e.applyReason,callback:function(t){e.applyReason=t},expression:"applyReason"}})],1)],2)},r=[function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"riskDescription gray-8"},[s("div",{staticClass:"title"},[t._v("EzPay风控")]),s("div",[t._v(" 1、为了降低您的交易风险，认证用户已向平台缴纳保证金，请放心 交易。 ")]),s("div",[t._v(" 2、平台认证用户，由平台担保交易资金安全性，如出现资金问题由 平台方全额赔付。 ")])])}],n=s(5628),i=s(1688),o=s(211),l=s(1380),c={components:{BankPaymentInfo:o.JF,WechatPaymentInfo:o.Ey,AliPaymentInfo:o.q$},data(){return{PAYMENT_METHOD:n.hL,STATUS_TYPE:n.Z2,STEP:n.g0,TRANSACTING_ORDER_STATUS:n.eD,status:n.eD.HANGING,countdown:1,isTimeOut:!1,show_apply:!1,applyReason:"",loading:!1,radio:"",orderInfo:{},buyerPayment:{},sellerPayment:{},componentsMapping:{[n.hL.BANK]:"BankPaymentInfo",[n.hL.ALI]:"AliPaymentInfo",[n.hL.WE_CHAT]:"WechatPaymentInfo"}}},computed:{hide(){return!(this.status===this.TRANSACTING_ORDER_STATUS.TRANSFERRED&&!this.isCountdownEnd||this.status===this.TRANSACTING_ORDER_STATUS.DISPUTING)},isCountdownEnd(){return this.countdown<=0},stepsActive(){return this.STEP[this.status]},isTimeoutDisputing(){return!(this.status!=this.TRANSACTING_ORDER_STATUS.DISPUTING||!this.isTimeOut)},payments(){return this.$root.parsePayments(this.orderInfo.paymentType)},isSystemBuyer(){return"System"===this.orderInfo.buyerType}},created(){this.load(),this.$root.$emit("root:set-topbar",["left-back","customer-service"])},beforeDestroy(){clearTimeout(this.timer)},methods:{transactingOrderStatus(...t){return this.$options.filters.transactingOrderStatus(...t)},start_transaction(){(0,i.H9)().then((()=>{(0,l.N8)({orderId:this.$route.params.id}).then((({ok:t,msg:e})=>{t?(this.$toast.success(e),this.status=n.eD.WAITING_FOR_TRANSFER,this.load()):this.$toast.fail(e)}))}))},cancel_transaction(){(0,l.y6)().then((({ok:t,data:e,msg:s})=>{t?(0,i.VN)(e.allowedCancelsOrderDailyCount-e.cancelsOrderDailyCount,e.allowedCancelsOrderDailyCount).then((()=>{(0,l.CI)({orderId:this.$route.params.id}).then((({ok:t,msg:e})=>{t?(this.$toast.success(e),this.status=n.eD.SELLER_CANCELED_DEAL,this.load()):this.$toast.fail(e)}))})):this.$toast.fail(s)}))},did_not_received(){(0,i.EQ)().then((()=>{(0,l.Ej)({orderId:this.$route.params.id}).then((({ok:t,msg:e})=>{t?(this.$toast.success(e),this.status=n.eD.SELLER_DID_NOT_RECEIVE,this.load()):this.$toast.fail(e)}))}))},confirm_transfer(){(0,i.di)().then((()=>{(0,l.XW)({orderId:this.$route.params.id}).then((({ok:t,msg:e})=>{t?(this.$toast.success(e),this.status=n.eD.DEAL,this.load()):this.$toast.fail(e)}))}))},load(){this.loadDetails(this.$route.params.id)},loadDetails(t){this.loading||(this.loading=!0,(0,l.fW)({orderId:t}).then((({ok:t,msg:e,data:s})=>{this.loading=!1,t?(clearTimeout(this.timer),this.orderInfo=s.order,this.sellerPayment=s.sellerPayment,this.buyerPayment=s.buyerPayment,this.radio=s.order.paymentType,this.orderInfo.appeal>0?(this.status=n.eD.DISPUTING,this.orderInfo.status===n.eD.TIME_OVER&&(this.isTimeOut=!0)):this.status=this.orderInfo.status,s.currentStateExpireTime&&(s.currentStateExpireTime.expire?this.countdown=1e3*s.currentStateExpireTime.expire-this.$root.getServerTime():this.countdown=0),this.refreshStatus()):this.$toast.fail(e)})))},refreshStatus(){this.timer=setTimeout((()=>{(0,l.dF)({orderId:this.$route.params.id}).then((({ok:t,data:e})=>{if(this.refreshStatus(),t){const t=this.status;this.orderInfo.appeal>0?(this.status=n.eD.DISPUTING,e.status===n.eD.TIME_OVER&&(this.isTimeOut=!0)):this.status=e.status,this.status!==t&&this.loadDetails(this.orderInfo.orderId)}})),console.log(1)}),1e4)},onCountdownFinish(){this.load()}}},d=c,u=s(1001),p=(0,u.Z)(d,a,r,!1,null,null,null),_=p.exports},1380:function(t,e,s){s.d(e,{$Z:function(){return l},$i:function(){return o},CI:function(){return T},Ej:function(){return v},Hn:function(){return d},N8:function(){return h},R9:function(){return A},T7:function(){return C},XW:function(){return f},_H:function(){return r},_d:function(){return S},an:function(){return _},cf:function(){return p},dF:function(){return u},fW:function(){return c},l$:function(){return y},uF:function(){return n},v1:function(){return i},vi:function(){return m},y6:function(){return R}});var a=s(1922);const r=t=>(0,a.q)({url:"/Api/Market/PendingOrder/marketPendingOrderList",method:"POST",data:t}),n=t=>(0,a.q)({url:"/Api/Market/Order/myOrderList",method:"GET",data:t}),i=t=>(0,a.q)({url:"/Api/Market/Sell/index",method:"POST",data:t}),o=t=>(0,a.q)({url:"/Api/Market/Sell/recycle",method:"POST",data:t}),l=t=>(0,a.q)({url:"Api/Market/PendingOrder/myPendingOrderList",method:"POST",data:t}),c=t=>(0,a.q)({url:"/Api/Market/Order/myOrderDetail",method:"GET",data:t}),d=t=>(0,a.q)({url:"/Api/Market/PendingOrder/marketPendingOrderDetail",method:"POST",data:t}),u=t=>(0,a.q)({url:"/Api/Market/Order/getCurrentOrderStatus",method:"GET",data:t}),p=t=>(0,a.q)({url:"/Api/Market/PendingOrder/myPendingOrderDetail",method:"GET",data:t}),_=t=>(0,a.q)({url:"/Api/Market/Order/buyerCreatesOrder",method:"POST",data:t}),m=t=>(0,a.q)({url:"/Api/Market/PendingOrder/getOrderListByPendingOrder",method:"GET",data:t}),T=t=>(0,a.q)({url:"/Api/Market/Order/sellerRefusesToCreateOrder",method:"POST",data:t}),h=t=>(0,a.q)({url:"/Api/Market/Order/sellerConfirmsToCreateOrder",method:"POST",data:t}),v=t=>(0,a.q)({url:"/Api/Market/Order/sellerHasNotReceivedPayment",method:"POST",data:t}),f=t=>(0,a.q)({url:"/Api/Market/Order/sellerCompletesOrder",method:"POST",data:t}),S=t=>(0,a.q)({url:"/Api/Market/Order/buyerCancelsOrder",method:"POST",data:t}),y=t=>(0,a.q)({url:"/Api/Market/Order/buyerConfirmsOrderHasBeenPaid",method:"POST",data:t}),A=t=>(0,a.q)({url:"/Api/Market/Order/buyerAppeals",method:"POST",data:t}),R=t=>(0,a.q)({url:"/Api/Market/Order/getCancelsOrderDailyCount",method:"GET",data:t}),C=t=>(0,a.q)({url:"/Api/User/TransferOrder/userDeposit",method:"POST",data:t})},1688:function(t,e,s){s.d(e,{EQ:function(){return o},H9:function(){return n},VN:function(){return i},di:function(){return l}});var a=s(9515);const r=(t,e)=>new Promise(((s,r)=>{a.Z.confirm({title:t,message:e,confirmButtonText:"是",cancelButtonText:"否",confirmButtonColor:"#6f59fe",allowHtml:!0,beforeClose(t,e){e(),"confirm"===t?s():r()}})})),n=()=>r("是否开始交易","<div>\n开始交易后可在“交易记录”，“订单”中\n「我的卖单」完成后续操作\n</div>"),i=(t,e=3)=>r("是否取消该笔交易",`<div>\n      <div class="tip">\n        提示：\n      </div>\n      <div>\n          1.如果你在一天内取消<span style="color:#FB2222">${e}次</span>订单，当天你的账户将会被停止买卖。\n      </div>\n      <div class="al-c">\n          今日还可取消\n          <span style="color:#FB2222">${t}次</span>\n          订单，请谨慎操作\n      </div>\n    </div>\n`),o=()=>r("是否未收到转账",'请再次确认您的收款账户是否未收到转账，\n如发现\n<span style="color:#FB2222">恶意不确认转币</span>\n可能会面临\n<span style="color:#FB2222">「永久封号」</span>\n处理'),l=()=>r("是否收到转账",'请再次确认买家否已付款，且到款信息\n是否与<span style="color:#FB2222">「买方付款信息」</span>一致')},211:function(t,e,s){s.d(e,{q$:function(){return R},JF:function(){return d},Ey:function(){return h}});var a=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("van-cell-group",{attrs:{border:!1},scopedSlots:t._u([{key:"title",fn:function(){return[s("span",{staticClass:"title"},[t._v(t._s(t.title))]),t._t("title-right")]},proxy:!0}],null,!0)},[s("van-cell",{staticClass:"kv",attrs:{title:"银行名称",border:!1}},[t._v(" "+t._s(t._f("hide")(t.findBank.bankName,t.hide,"中国农业银行"))+" ")]),s("van-cell",{staticClass:"kv",attrs:{title:"开户所在地",border:!1}},[t._v(" "+t._s(t._f("hide")(t.getAddrFromCode(t.payment.province,t.payment.city),t.hide,"北京市 北京市"))+" ")]),s("van-cell",{staticClass:"kv",attrs:{title:"开户支行",border:!1}},[t._v(" "+t._s(t._f("hide")(t.payment.bankBranch,t.hide,"黄浦区万达广场支行"))+" ")]),s("van-cell",{staticClass:"kv",attrs:{title:"姓名",border:!1},scopedSlots:t._u([{key:"right-icon",fn:function(){return[s("div",{staticClass:"copy"})]},proxy:!0}])},[t._v(" "+t._s(t._f("hide")(t.payment.realName,t.hide,"张三"))+" ")]),s("van-cell",{staticClass:"kv",attrs:{title:"银行卡号",border:!1},scopedSlots:t._u([{key:"right-icon",fn:function(){return[s("div",{staticClass:"copy"})]},proxy:!0}])},[t._v(" "+t._s(t._f("hide")(t.payment.bankNo,t.hide,"6227 0029 6666 7777 888"))+" ")])],1)},r=[],n=s(7601),i={props:{title:String,hide:Boolean,payment:{default:()=>({bankName:"中国农业银行",province:11e4,city:110100,bankBranch:"黄浦区万达广场支行",realName:"张三",bankNo:"6227 0029 6666 7777 888"})}},computed:{findBank(){return this.$root.banks.find((t=>t.bankId==this.payment.bankId))||{}}},methods:{getAddrFromCode(t,e){return n.H.province_list[t]+" "+n.H.city_list[e]}}},o=i,l=s(1001),c=(0,l.Z)(o,a,r,!1,null,"2c6bceb5",null),d=c.exports,u=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("van-cell-group",{attrs:{border:!1},scopedSlots:t._u([{key:"title",fn:function(){return[s("span",{staticClass:"title"},[t._v(t._s(t.title))])]},proxy:!0}])},[s("div",{staticClass:"wrapper"},[s("div",{staticClass:"left"},[s("van-cell",{staticClass:"kv",attrs:{title:"微信账号",border:!1},scopedSlots:t._u([{key:"right-icon",fn:function(){return[s("button",{directives:[{name:"clipboard",rawName:"v-clipboard",value:t.hide?"":t.payment.account||"",expression:"hide ? '' : payment.account || ''"}],staticClass:"copy copyBtn",on:{success:t.$root.copySuccessful}})]},proxy:!0}])},[t._v(" "+t._s(t._f("hide")(t.payment.account,t.hide,"微信"))+" ")]),s("van-cell",{staticClass:"kv",attrs:{title:"姓名",border:!1},scopedSlots:t._u([{key:"right-icon",fn:function(){return[s("button",{directives:[{name:"clipboard",rawName:"v-clipboard",value:t.hide?"":t.payment.realName||"",expression:"hide ? '' : payment.realName || ''"}],staticClass:"copy copyBtn",on:{success:t.$root.copySuccessful}})]},proxy:!0}])},[t._v(" "+t._s(t._f("hide")(t.payment.realName,t.hide,"张三"))+" ")])],1),t.hide?s("div",{staticClass:"qr"},[[t._v(" 收款二维码 ")]],2):s("van-image",{attrs:{src:t.hide?"":t.$root.getImageUrl(t.payment.receiptCode)}})],1)])},p=[],_={props:{title:String,hide:Boolean,payment:{default:()=>({account:"微信",realName:"张三",receiptCode:""})}}},m=_,T=(0,l.Z)(m,u,p,!1,null,"059397e8",null),h=T.exports,v=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("van-cell-group",{attrs:{border:!1},scopedSlots:t._u([{key:"title",fn:function(){return[s("span",{staticClass:"title"},[t._v(t._s(t.title))])]},proxy:!0}])},[s("div",{staticClass:"wrapper"},[s("div",{staticClass:"left"},[s("van-cell",{staticClass:"kv",attrs:{title:"支付宝账号",border:!1},scopedSlots:t._u([{key:"right-icon",fn:function(){return[s("button",{directives:[{name:"clipboard",rawName:"v-clipboard",value:t.hide?"":t.payment.account||"",expression:"hide ? '' : payment.account || ''"}],staticClass:"copy copyBtn",on:{success:t.$root.copySuccessful}})]},proxy:!0}])},[t._v(" "+t._s(t._f("hide")(t.payment.account,t.hide,"支付宝"))+" ")]),s("van-cell",{staticClass:"kv",attrs:{title:"姓名",border:!1},scopedSlots:t._u([{key:"right-icon",fn:function(){return[s("button",{directives:[{name:"clipboard",rawName:"v-clipboard",value:t.hide?"":t.payment.realName||"",expression:"hide ? '' : payment.realName || ''"}],staticClass:"copy copyBtn",on:{success:t.$root.copySuccessful}})]},proxy:!0}])},[t._v(" "+t._s(t._f("hide")(t.payment.realName,t.hide,"张三"))+" ")])],1),t.hide?s("div",{staticClass:"qr"},[[t._v(" 收款二维码 ")]],2):s("van-image",{attrs:{src:t.hide?"":t.$root.getImageUrl(t.payment.receiptCode)}})],1)])},f=[],S={props:{title:String,hide:Boolean,payment:{default:()=>({account:"支付宝",realName:"张三",receiptCode:""})}}},y=S,A=(0,l.Z)(y,v,f,!1,null,"608e2fb6",null),R=A.exports}}]);