"use strict";(self["webpackChunkez_pay"]=self["webpackChunkez_pay"]||[]).push([[353],{4616:function(t,e,r){r.r(e),r.d(e,{default:function(){return m}});var a=function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("div",{staticClass:"page page-buy"},[r("div",{staticClass:"top-wrapper"},[r("div",{staticClass:"merchant",class:{split:!!t.orderInfo.isSplit}},[r("div",{staticClass:"left"},[r("van-image",{staticClass:"avatar",attrs:{src:t.$root.getImageUrl(t.orderInfo.sellerAvatar),round:""}},[r("div",{staticClass:"defaultAvatar size45",attrs:{slot:"error"},slot:"error"})]),r("div",{staticClass:"name"},[t._v(t._s(t.orderInfo.sellerNickname))])],1),r("div",{staticClass:"right"},[r("div",{staticClass:"label"},[t._v("可购买总额（EzB）")]),r("div",{staticClass:"amount"},[t._v(t._s(t.orderInfo.validAmount))])])])]),r("van-form",{on:{submit:t.onSubmit}},[r("van-field",{attrs:{autocomplete:t.$root.getHash(),type:"number",label:"购买数量：",readonly:!t.orderInfo.isSplit,placeholder:t.orderInfo.minBuyEach+"～"+t.orderInfo.validAmount+"/EzB"},model:{value:t.form.amount,callback:function(e){t.$set(t.form,"amount",e)},expression:"form.amount"}}),r("van-cell",{staticClass:"payment",attrs:{title:"支付方式："}},[r("van-radio-group",{model:{value:t.form.paymentType,callback:function(e){t.$set(t.form,"paymentType",e)},expression:"form.paymentType"}},t._l(t.payments,(function(e,a){return r("van-radio",{key:a,staticClass:"btn",attrs:{disabled:!t.$root.validPayments[e],name:e}},[r("van-button",{staticClass:"btn",attrs:{slot:"icon","native-type":"button"},slot:"icon"},[r("span",{staticClass:"item",class:"pay"+e}),t._v(" "+t._s(t._f("paymentMethod")(e,"content"))+" ")])],1)})),1)],1),r("van-cell",[r("van-radio-group",{model:{value:t.form.buyerPaymentTypeId,callback:function(e){t.$set(t.form,"buyerPaymentTypeId",e)},expression:"form.buyerPaymentTypeId"}},t._l(t.paymentChannel,(function(e,a){return r("van-cell",{key:a,staticClass:"paymentChannel",attrs:{title:t.form.paymentType===t.PAYMENT_METHOD.BANK?t.bankIdMappingName[e.bankId]:e.account,value:e.bankNo},on:{click:function(r){t.form.buyerPaymentTypeId=e.id}},scopedSlots:t._u([{key:"right-icon",fn:function(){return[r("van-radio",{attrs:{name:e.id}})]},proxy:!0}],null,!0)})})),1)],1),r("van-button",{staticClass:"primary block",attrs:{"native-type":"submit"}},[t._v(" 确定购买 ")]),r("p",{staticClass:"tip"},[t._v("确认购买后如未自动跳转请到交易记录中查看我的买单")])],1)],1)},n=[],o=r(5628),i=r(1380),s={data(){return{PAYMENT_METHOD:o.hL,form:{amount:"",buyerPaymentTypeId:"",paymentType:""},orderInfo:{}}},computed:{payments(){return this.$root.parsePayments(this.orderInfo.paymentType)},paymentChannel(){return(Object.entries(this.$root.payments).map((([t,e])=>e)).find((t=>t.type===this.form.paymentType))||{}).list||[]},bankIdMappingName(){return this.$root.banks.reduce(((t,e)=>({...t,[e.bankId]:e.bankName})),{})}},created(){this.loadOrderInfo(this.$route.params.id),this.$root.$emit("root:set-topbar",["left-back","customer-service"])},methods:{onSubmit(){return this.form.amount?this.form.amount.toNumber()<this.orderInfo.minBuyEach.toNumber()?this.$toast.fail(`购买数额不得小于最低可购买额${this.orderInfo.minBuyEach}`):this.form.amount.toNumber()>this.orderInfo.validAmount.toNumber()?this.$toast.fail(`购买数额不得大于最高可购买额${this.orderInfo.minBuyEach}`):this.form.paymentType?this.form.buyerPaymentTypeId?void(0,i.an)(this.$root.$tls.processParams({pendingOrderId:this.orderInfo.pendingOrderId.toString(),amount:this.form.amount.toNumber(),buyerPaymentTypeId:this.form.buyerPaymentTypeId.toString(),paymentType:this.form.paymentType.toString()},["float","shake"])).then((({ok:t,data:e,msg:r})=>{t?this.$router.replace(`/transaction_buy/${e.orderId}`):this.$toast.fail(r)})):this.$toast.fail("请选择支付账号"):this.$toast.fail("请选择支付方式"):this.$toast.fail("请输入购买数额")},loadOrderInfo(t){(0,i.Hn)({pendingOrderId:t}).then((({ok:t,msg:e,data:r})=>{t?(r.isSplit||(this.form.amount=r.validAmount),this.orderInfo=r,this.loadPayments().then((()=>{this.payments.forEach((t=>{this.$root.validPayments[t]&&(this.form.paymentType=t)})),this.form.paymentType||this.warnning()}))):this.$toast.fail(e)}))},loadPayments(){return this.$root.loadPayments()},warnning(){this.$dialog.confirm({message:"您还未绑定该支付方式的支付账号,请绑定对应支付账号后再选择该支付方式",confirmButtonText:"去绑定",showCancelButton:!0,beforeClose:(t,e)=>{"confirm"===t&&this.$router.replace("/add_payment"),e()}})}}},d=s,u=r(1001),l=(0,u.Z)(d,a,n,!1,null,null,null),m=l.exports},1380:function(t,e,r){r.d(e,{$Z:function(){return d},$i:function(){return s},CI:function(){return y},Ej:function(){return O},Hn:function(){return l},N8:function(){return h},R9:function(){return k},T7:function(){return g},XW:function(){return v},_H:function(){return n},_d:function(){return b},an:function(){return c},cf:function(){return p},dF:function(){return m},fW:function(){return u},l$:function(){return T},uF:function(){return o},v1:function(){return i},vi:function(){return f},y6:function(){return P}});var a=r(1922);const n=t=>(0,a.q)({url:"/Api/Market/PendingOrder/marketPendingOrderList",method:"POST",data:t}),o=t=>(0,a.q)({url:"/Api/Market/Order/myOrderList",method:"GET",data:t}),i=t=>(0,a.q)({url:"/Api/Market/Sell/index",method:"POST",data:t}),s=t=>(0,a.q)({url:"/Api/Market/Sell/recycle",method:"POST",data:t}),d=t=>(0,a.q)({url:"Api/Market/PendingOrder/myPendingOrderList",method:"POST",data:t}),u=t=>(0,a.q)({url:"/Api/Market/Order/myOrderDetail",method:"GET",data:t}),l=t=>(0,a.q)({url:"/Api/Market/PendingOrder/marketPendingOrderDetail",method:"POST",data:t}),m=t=>(0,a.q)({url:"/Api/Market/Order/getCurrentOrderStatus",method:"GET",data:t}),p=t=>(0,a.q)({url:"/Api/Market/PendingOrder/myPendingOrderDetail",method:"GET",data:t}),c=t=>(0,a.q)({url:"/Api/Market/Order/buyerCreatesOrder",method:"POST",data:t}),f=t=>(0,a.q)({url:"/Api/Market/PendingOrder/getOrderListByPendingOrder",method:"GET",data:t}),y=t=>(0,a.q)({url:"/Api/Market/Order/sellerRefusesToCreateOrder",method:"POST",data:t}),h=t=>(0,a.q)({url:"/Api/Market/Order/sellerConfirmsToCreateOrder",method:"POST",data:t}),O=t=>(0,a.q)({url:"/Api/Market/Order/sellerHasNotReceivedPayment",method:"POST",data:t}),v=t=>(0,a.q)({url:"/Api/Market/Order/sellerCompletesOrder",method:"POST",data:t}),b=t=>(0,a.q)({url:"/Api/Market/Order/buyerCancelsOrder",method:"POST",data:t}),T=t=>(0,a.q)({url:"/Api/Market/Order/buyerConfirmsOrderHasBeenPaid",method:"POST",data:t}),k=t=>(0,a.q)({url:"/Api/Market/Order/buyerAppeals",method:"POST",data:t}),P=t=>(0,a.q)({url:"/Api/Market/Order/getCancelsOrderDailyCount",method:"GET",data:t}),g=t=>(0,a.q)({url:"/Api/User/TransferOrder/userDeposit",method:"POST",data:t})}}]);