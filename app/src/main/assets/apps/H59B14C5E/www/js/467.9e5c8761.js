"use strict";(self["webpackChunkez_pay"]=self["webpackChunkez_pay"]||[]).push([[467],{3467:function(t,e,r){r.r(e),r.d(e,{default:function(){return c}});var a=function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("div",{staticClass:"page page-sale"},[r("div",{staticClass:"top-wrapper"},[r("div",{staticClass:"merchant"},[r("div",{staticClass:"left"},[r("van-image",{staticClass:"avatar",attrs:{src:t.$root.getImageUrl(t.$root.userInfo.avatar),round:"",fit:"cover"}}),r("div",{staticClass:"name"},[t._v(t._s(t.$root.userInfo.nickname))])],1),r("div",{staticClass:"right"},[r("div",{staticClass:"label"},[t._v("可出售总额（EzB）")]),r("div",{staticClass:"amount"},[t._v(" "+t._s(parseFloat(t.$root.userInfo.balance).toFixed(2))+" ")])])])]),r("van-form",{on:{submit:t.handlerSubmit}},[r("van-field",{attrs:{autocomplete:t.$root.getHash(),type:"number",label:"出售数量：",placeholder:"最低出售数量为10/EzB"},model:{value:t.form.amount,callback:function(e){t.$set(t.form,"amount",e)},expression:"form.amount"}}),t.form.isSplit?r("van-field",{attrs:{autocomplete:t.$root.getHash(),type:"number",label:"最低购买：",placeholder:"请填写买家最低可购买数量"},model:{value:t.form.minBuyEach,callback:function(e){t.$set(t.form,"minBuyEach",e)},expression:"form.minBuyEach"}}):t._e(),r("van-collapse",{model:{value:t.form.paymentType,callback:function(e){t.$set(t.form,"paymentType",e)},expression:"form.paymentType"}},[r("van-checkbox-group",{model:{value:t.form.paymentType,callback:function(e){t.$set(t.form,"paymentType",e)},expression:"form.paymentType"}},[r("van-cell-group",{attrs:{title:"请选择收款方式"}},t._l(t.$root.payments,(function(e,a){return r("van-collapse-item",{key:a,staticClass:"payment",attrs:{title:0===e.list.length?"未绑定该收款方式":e.typeName,name:e.type,clickable:"",disabled:0===e.list.length},scopedSlots:t._u([{key:"icon",fn:function(){return[r("div",{staticClass:"payment-icon",class:a})]},proxy:!0},{key:"right-icon",fn:function(){return[r("van-checkbox",{attrs:{name:e.type,disabled:0===e.list.length,shape:"square"}})]},proxy:!0}],null,!0)},[r("van-radio-group",{model:{value:t.form.payments[a],callback:function(e){t.$set(t.form.payments,a,e)},expression:"form.payments[k]"}},t._l(e.list,(function(n,o){return r("van-cell",{key:o,staticClass:"paymentChannel",attrs:{title:e.type===t.PAYMENT_METHOD.BANK?t.$root.banksIdMappingName[n.bankId]:"账号:"+n.account,value:(n.bankNo||"").replace(/\d{4}/g,(function(t){return t+" "})),clickable:""},on:{click:function(e){t.form.payments[a]=n.id}},scopedSlots:t._u([{key:"right-icon",fn:function(){return[r("van-radio",{attrs:{name:n.id}})]},proxy:!0}],null,!0)})})),1)],1)})),1)],1)],1),r("van-cell-group",{staticClass:"split",attrs:{title:"是否拆分",border:!1}},[r("van-radio-group",{model:{value:t.form.isSplit,callback:function(e){t.$set(t.form,"isSplit",e)},expression:"form.isSplit"}},[r("van-radio",{staticClass:"btn",attrs:{name:1}},[r("div",{staticClass:"btn",attrs:{slot:"icon"},slot:"icon"},[t._v("可拆分")])]),r("van-radio",{staticClass:"btn",attrs:{name:0}},[r("div",{staticClass:"btn",attrs:{slot:"icon"},slot:"icon"},[t._v("不可拆分")])])],1)],1),r("van-button",{staticClass:"block primary",attrs:{"native-type":"submit"}},[t._v(" 发布挂单 ")])],1)],1)},n=[],o=r(5628),s=r(1380),i={data(){return{PAYMENT_METHOD:o.hL,collapse:"",form:{amount:"",minBuyEach:"",paymentType:[],isSplit:1,payments:{}}}},computed:{paymentsMappingIds(){const t={};for(const e in this.$root.payments){const r=this.$root.payments[e];t[r.type]=r.list}return t}},watch:{"form.paymentType"(t,e){const r=new Set(e);for(const n of t)if(!r.has(n)){this.form.payments[n===o.hL.BANK?"bank":n===o.hL.ALI?"ali":"wechat"]=this.paymentsMappingIds[n][0].id;break}const a=new Set(t);for(const n of e)if(!a.has(n)){this.form.payments[n===o.hL.BANK?"bank":n===o.hL.ALI?"ali":"wechat"]="";break}},"form.isSplit"(){this.form.minBuyEach=""}},created(){this.loadPayments(),this.$root.$emit("root:set-topbar",["left-back","customer-service"])},methods:{loadPayments(){this.$root.loadPayments().then((({ok:t})=>{t&&Object.keys(this.$root.payments).forEach((t=>{this.$set(this.form.payments,t,"")}))}))},handlerSubmit(){const t=Object.entries(this.form.payments).map((([t,e])=>e)).filter((t=>t>0)).join(",").toString();if(this.form.amount<10)return this.$toast.fail("最低出售量为10");if(!t.length)return this.$toast.fail("请选择支付方式");let e=!0;return this.form.paymentType.forEach((t=>t===o.hL.BANK&&0===this.$root.payments.bank.list.length||t===o.hL.ALI&&0===this.$root.payments.ali.list.length||t===o.hL.WE_CHAT&&0===this.$root.payments.wechat.list.length?this.paymentVerifyFlag=!1:void 0)),e?this.form.isSplit&&!this.form.minBuyEach?this.$toast.fail("请输入最低购买数量"):this.form.isSplit&&this.form.minBuyEach.toNumber()>this.form.amount.toNumber()?this.$toast.fail("最低购买量不得高于出售量"):(this.$root.$emit("root:open-global-password"),void this.$root.$once("root:global-password",(e=>{e&&(0,s.v1)(this.$tls.processParams({amount:Number(this.form.amount),minBuyEach:Number(this.form.minBuyEach),paymentType:this.form.paymentType.reduce(((t,e)=>t+e),0).toString(),paymentTypeId:t,isSplit:this.form.isSplit.toString(),maxBuyEach:Number(this.form.amount),sign:"",securePassword:e},["float","shake"])).then((({ok:t,data:e,msg:r})=>{t?(this.$root.fetchUserInfo(),this.$router.push("my_hang_orders")):this.$toast.fail(r)}))}))):this.$toast.fail("请选择支付账户")}}},l=i,m=r(1001),u=(0,m.Z)(l,a,n,!1,null,null,null),c=u.exports},1380:function(t,e,r){r.d(e,{$Z:function(){return l},$i:function(){return i},CI:function(){return h},Ej:function(){return k},Hn:function(){return u},N8:function(){return y},R9:function(){return g},T7:function(){return $},XW:function(){return v},_H:function(){return n},_d:function(){return b},an:function(){return p},cf:function(){return d},dF:function(){return c},fW:function(){return m},l$:function(){return O},uF:function(){return o},v1:function(){return s},vi:function(){return f},y6:function(){return T}});var a=r(1922);const n=t=>(0,a.q)({url:"/Api/Market/PendingOrder/marketPendingOrderList",method:"POST",data:t}),o=t=>(0,a.q)({url:"/Api/Market/Order/myOrderList",method:"GET",data:t}),s=t=>(0,a.q)({url:"/Api/Market/Sell/index",method:"POST",data:t}),i=t=>(0,a.q)({url:"/Api/Market/Sell/recycle",method:"POST",data:t}),l=t=>(0,a.q)({url:"Api/Market/PendingOrder/myPendingOrderList",method:"POST",data:t}),m=t=>(0,a.q)({url:"/Api/Market/Order/myOrderDetail",method:"GET",data:t}),u=t=>(0,a.q)({url:"/Api/Market/PendingOrder/marketPendingOrderDetail",method:"POST",data:t}),c=t=>(0,a.q)({url:"/Api/Market/Order/getCurrentOrderStatus",method:"GET",data:t}),d=t=>(0,a.q)({url:"/Api/Market/PendingOrder/myPendingOrderDetail",method:"GET",data:t}),p=t=>(0,a.q)({url:"/Api/Market/Order/buyerCreatesOrder",method:"POST",data:t}),f=t=>(0,a.q)({url:"/Api/Market/PendingOrder/getOrderListByPendingOrder",method:"GET",data:t}),h=t=>(0,a.q)({url:"/Api/Market/Order/sellerRefusesToCreateOrder",method:"POST",data:t}),y=t=>(0,a.q)({url:"/Api/Market/Order/sellerConfirmsToCreateOrder",method:"POST",data:t}),k=t=>(0,a.q)({url:"/Api/Market/Order/sellerHasNotReceivedPayment",method:"POST",data:t}),v=t=>(0,a.q)({url:"/Api/Market/Order/sellerCompletesOrder",method:"POST",data:t}),b=t=>(0,a.q)({url:"/Api/Market/Order/buyerCancelsOrder",method:"POST",data:t}),O=t=>(0,a.q)({url:"/Api/Market/Order/buyerConfirmsOrderHasBeenPaid",method:"POST",data:t}),g=t=>(0,a.q)({url:"/Api/Market/Order/buyerAppeals",method:"POST",data:t}),T=t=>(0,a.q)({url:"/Api/Market/Order/getCancelsOrderDailyCount",method:"GET",data:t}),$=t=>(0,a.q)({url:"/Api/User/TransferOrder/userDeposit",method:"POST",data:t})}}]);